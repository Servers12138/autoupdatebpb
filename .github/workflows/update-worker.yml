name: Update Worker

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *" # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€æŸ¥ä»“åº“
        uses: actions/checkout@v3

      - name: åˆ é™¤æ—§æ–‡ä»¶
        run: |
          rm -rf ./*

      - name: ä¸‹è½½å¹¶è§£å‹ BPB-Worker-Panel
        run: |
          curl -L https://github.com/xyTom/bpb-worker-panel/archive/refs/heads/main.zip -o main.zip
          unzip -o main.zip
          mv bpb-worker-panel-main/* ./
          rm -rf bpb-worker-panel-main main.zip

      # ğŸ”¥ è‡ªåŠ¨æ‰“è¡¥ä¸æ­¥éª¤
      - name: ç»™ _worker.js æ‰“è¡¥ä¸ï¼ˆæ·»åŠ  ip.txt è¯»å–åŠŸèƒ½ï¼‰
        run: |
          echo -e "\033[34m[ç»™ _worker.js æ‰“è¡¥ä¸]\033[0m"
          sed -i '1i\
// ====== è‡ªåŠ¨è¯»å– ip.txt åŠŸèƒ½å¼€å§‹ ======\n\
async function getIPList() {\n\
  try {\n\
    let resp = await fetch("https://private.zzjay.pp.ua/ip.txt");\n\
    let text = await resp.text();\n\
    return text.split("\\n").filter(line => line.trim() !== "");\n\
  } catch (e) {\n\
    return [];\n\
  }\n\
}\n\
// ====== è‡ªåŠ¨è¯»å– ip.txt åŠŸèƒ½ç»“æŸ ======\n\
' _worker.js

      - name: æäº¤æ›´æ”¹åˆ°ä»“åº“
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "è‡ªåŠ¨æ›´æ–° Worker ä»£ç "
          git push
